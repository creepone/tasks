var apn = require ('apn');

var token = "<insert token here>";

if(token == "<insert token here>") {
    console.log("Please set token to a valid device token for the push notification service");
    process.exit();
}

var service = new apn.connection({ cacheLength: 100, pfx:'pushTest.pfx', gateway:'gateway.sandbox.push.apple.com', enhanced: true, errorCallback: function(n, z) { console.log("Error:", n, z)}});

service.on('transmitted', function(notification) {
    if(notification.badge === 1) {
        console.time("notifications");
    }
    if(notification.badge === count) {
        console.timeEnd("notifications");
    }
});

var feedback = new apn.feedback({pfx:'pushTest.pfx', gateway:'feedback.sandbox.push.apple.com', feedback: console.log, errorCallback: function(z) { console.log("Error: " + z)}, interval: 5});

var i=0;
var count = 1000;

function pushNotification() {
    if(i >= count) return;
    var note = new apn.notification();
    note.badge = i+1;
    service.pushNotification(note, token);
    i++;
    console.log(i);
    setTimeout(arguments.callee, 1);    
};

pushNotification();